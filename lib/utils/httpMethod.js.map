{"version":3,"file":"httpMethod.js","names":["_","require","httpMethod","method","middlewares","arguments","length","Array","prototype","slice","call","target","name","descriptor","targetFunction","isHof","kind","value","enumerable","Error","pos","indexOf","__metaRoute","substr","toLocaleLowerCase","__metaHttpMethod","isPlainObject","__metaMiddlewares","map","options","castArray","module","exports"],"sources":["../../src/utils/httpMethod.js"],"sourcesContent":["const { _ } = require(\"@genx/july\");\n\nfunction httpMethod(method, middlewares) {\n    if (arguments.length === 3) {\n        return httpMethod(\"get\")(...Array.prototype.slice.call(arguments));\n    }\n\n    return function (target, name, descriptor) {\n        let targetFunction,\n            isHof = false;\n\n        if (arguments.length === 1 && typeof target === \"function\") {\n            targetFunction = target;\n            isHof = true;\n        } else if (arguments.length === 1 && target.kind === \"method\") {\n            targetFunction = target.descriptor.value;\n            target.descriptor.enumerable = true;\n        } else if (descriptor && descriptor.value) {\n            targetFunction = descriptor.value;\n            descriptor.enumerable = true;\n        } else {\n            throw new Error(\"Unsupported scenario.\");\n        }\n\n        if (targetFunction) {\n            if (typeof method === \"string\") {\n                let pos = method.indexOf(\":/\");\n\n                if (pos !== -1) {\n                    if (pos === 0) {\n                        throw new Error(\"Invalid httpMethod decorator param: \" + method);\n                    }\n\n                    // like get:/, or post:/\n\n                    //override actionName as route\n                    targetFunction.__metaRoute = method.substr(pos + 1);\n                    method = method.substr(0, pos).toLocaleLowerCase();\n                }\n            } else {\n                method = \"get\";\n            }\n\n            targetFunction.__metaHttpMethod = method;\n\n            if (middlewares) {\n                if (_.isPlainObject(middlewares)) {\n                    targetFunction.__metaMiddlewares = _.map(middlewares, (options, name) => ({ name, options }));\n                } else {\n                    targetFunction.__metaMiddlewares = _.castArray(middlewares);\n                }\n            }\n        }\n\n        return isHof ? targetFunction : descriptor;\n    };\n}\n\nmodule.exports = httpMethod;\n"],"mappings":";;;AAAA,MAAM;EAAEA;AAAE,CAAC,GAAGC,OAAO,CAAC,YAAY,CAAC;AAEnC,SAASC,UAAUA,CAACC,MAAM,EAAEC,WAAW,EAAE;EACrC,IAAIC,SAAS,CAACC,MAAM,KAAK,CAAC,EAAE;IACxB,OAAOJ,UAAU,CAAC,KAAK,CAAC,CAAC,GAAGK,KAAK,CAACC,SAAS,CAACC,KAAK,CAACC,IAAI,CAACL,SAAS,CAAC,CAAC;EACtE;EAEA,OAAO,UAAUM,MAAM,EAAEC,IAAI,EAAEC,UAAU,EAAE;IACvC,IAAIC,cAAc;MACdC,KAAK,GAAG,KAAK;IAEjB,IAAIV,SAAS,CAACC,MAAM,KAAK,CAAC,IAAI,OAAOK,MAAM,KAAK,UAAU,EAAE;MACxDG,cAAc,GAAGH,MAAM;MACvBI,KAAK,GAAG,IAAI;IAChB,CAAC,MAAM,IAAIV,SAAS,CAACC,MAAM,KAAK,CAAC,IAAIK,MAAM,CAACK,IAAI,KAAK,QAAQ,EAAE;MAC3DF,cAAc,GAAGH,MAAM,CAACE,UAAU,CAACI,KAAK;MACxCN,MAAM,CAACE,UAAU,CAACK,UAAU,GAAG,IAAI;IACvC,CAAC,MAAM,IAAIL,UAAU,IAAIA,UAAU,CAACI,KAAK,EAAE;MACvCH,cAAc,GAAGD,UAAU,CAACI,KAAK;MACjCJ,UAAU,CAACK,UAAU,GAAG,IAAI;IAChC,CAAC,MAAM;MACH,MAAM,IAAIC,KAAK,CAAC,uBAAuB,CAAC;IAC5C;IAEA,IAAIL,cAAc,EAAE;MAChB,IAAI,OAAOX,MAAM,KAAK,QAAQ,EAAE;QAC5B,IAAIiB,GAAG,GAAGjB,MAAM,CAACkB,OAAO,CAAC,IAAI,CAAC;QAE9B,IAAID,GAAG,KAAK,CAAC,CAAC,EAAE;UACZ,IAAIA,GAAG,KAAK,CAAC,EAAE;YACX,MAAM,IAAID,KAAK,CAAC,sCAAsC,GAAGhB,MAAM,CAAC;UACpE;UAKAW,cAAc,CAACQ,WAAW,GAAGnB,MAAM,CAACoB,MAAM,CAACH,GAAG,GAAG,CAAC,CAAC;UACnDjB,MAAM,GAAGA,MAAM,CAACoB,MAAM,CAAC,CAAC,EAAEH,GAAG,CAAC,CAACI,iBAAiB,CAAC,CAAC;QACtD;MACJ,CAAC,MAAM;QACHrB,MAAM,GAAG,KAAK;MAClB;MAEAW,cAAc,CAACW,gBAAgB,GAAGtB,MAAM;MAExC,IAAIC,WAAW,EAAE;QACb,IAAIJ,CAAC,CAAC0B,aAAa,CAACtB,WAAW,CAAC,EAAE;UAC9BU,cAAc,CAACa,iBAAiB,GAAG3B,CAAC,CAAC4B,GAAG,CAACxB,WAAW,EAAE,CAACyB,OAAO,EAAEjB,IAAI,MAAM;YAAEA,IAAI;YAAEiB;UAAQ,CAAC,CAAC,CAAC;QACjG,CAAC,MAAM;UACHf,cAAc,CAACa,iBAAiB,GAAG3B,CAAC,CAAC8B,SAAS,CAAC1B,WAAW,CAAC;QAC/D;MACJ;IACJ;IAEA,OAAOW,KAAK,GAAGD,cAAc,GAAGD,UAAU;EAC9C,CAAC;AACL;AAEAkB,MAAM,CAACC,OAAO,GAAG9B,UAAU"}