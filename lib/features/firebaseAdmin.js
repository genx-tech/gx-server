"use strict";

require("source-map-support/register");

const {
  Feature
} = require('..').Enums;

const {
  tryRequire
} = require('@genx/app/lib/utils/Helpers');

const {
  InvalidConfiguration
} = require('@genx/error');

const {
  fs
} = require('rk-utils');

module.exports = {
  type: Feature.SERVICE,
  load_: async function (app, options) {
    if (!options || typeof options.serviceAccount !== 'string') {
      throw new InvalidConfiguration('Missing required configuration item "firebase.serviceAccount".');
    }

    const admin = tryRequire('firebase-admin');
    const serviceAccount = await fs.readJson(options.serviceAccount, 'utf8');
    const firebaseAdminApp = admin.initializeApp({
      credential: admin.credential.cert(serviceAccount)
    });
    app.registerService('firebaseAdmin', firebaseAdminApp);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9maXJlYmFzZUFkbWluLmpzIl0sIm5hbWVzIjpbIkZlYXR1cmUiLCJyZXF1aXJlIiwiRW51bXMiLCJ0cnlSZXF1aXJlIiwiSW52YWxpZENvbmZpZ3VyYXRpb24iLCJmcyIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0eXBlIiwiU0VSVklDRSIsImxvYWRfIiwiYXBwIiwib3B0aW9ucyIsInNlcnZpY2VBY2NvdW50IiwiYWRtaW4iLCJyZWFkSnNvbiIsImZpcmViYXNlQWRtaW5BcHAiLCJpbml0aWFsaXplQXBwIiwiY3JlZGVudGlhbCIsImNlcnQiLCJyZWdpc3RlclNlcnZpY2UiXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBT0EsTUFBTTtBQUFFQSxFQUFBQTtBQUFGLElBQWNDLE9BQU8sQ0FBQyxJQUFELENBQVAsQ0FBY0MsS0FBbEM7O0FBQ0EsTUFBTTtBQUFFQyxFQUFBQTtBQUFGLElBQWlCRixPQUFPLENBQUMsNkJBQUQsQ0FBOUI7O0FBQ0EsTUFBTTtBQUFFRyxFQUFBQTtBQUFGLElBQTJCSCxPQUFPLENBQUMsYUFBRCxDQUF4Qzs7QUFDQSxNQUFNO0FBQUVJLEVBQUFBO0FBQUYsSUFBU0osT0FBTyxDQUFDLFVBQUQsQ0FBdEI7O0FBRUFLLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQU1iQyxFQUFBQSxJQUFJLEVBQUVSLE9BQU8sQ0FBQ1MsT0FORDtBQWViQyxFQUFBQSxLQUFLLEVBQUUsZ0JBQWdCQyxHQUFoQixFQUFxQkMsT0FBckIsRUFBOEI7QUFDakMsUUFBSSxDQUFDQSxPQUFELElBQVksT0FBT0EsT0FBTyxDQUFDQyxjQUFmLEtBQWtDLFFBQWxELEVBQTREO0FBQ3hELFlBQU0sSUFBSVQsb0JBQUosQ0FBeUIsZ0VBQXpCLENBQU47QUFDSDs7QUFFRCxVQUFNVSxLQUFLLEdBQUdYLFVBQVUsQ0FBQyxnQkFBRCxDQUF4QjtBQUVBLFVBQU1VLGNBQWMsR0FBRyxNQUFNUixFQUFFLENBQUNVLFFBQUgsQ0FBWUgsT0FBTyxDQUFDQyxjQUFwQixFQUFvQyxNQUFwQyxDQUE3QjtBQUVBLFVBQU1HLGdCQUFnQixHQUFHRixLQUFLLENBQUNHLGFBQU4sQ0FBb0I7QUFDekNDLE1BQUFBLFVBQVUsRUFBRUosS0FBSyxDQUFDSSxVQUFOLENBQWlCQyxJQUFqQixDQUFzQk4sY0FBdEI7QUFENkIsS0FBcEIsQ0FBekI7QUFJQUYsSUFBQUEsR0FBRyxDQUFDUyxlQUFKLENBQW9CLGVBQXBCLEVBQXFDSixnQkFBckM7QUFDSDtBQTdCWSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIEVuYWJsZSBmaXJlYmFzZSBmZWF0dXJlLlxuICogQG1vZHVsZSBGZWF0dXJlX0ZpcmViYXNlXG4gKi9cblxuY29uc3QgeyBGZWF0dXJlIH0gPSByZXF1aXJlKCcuLicpLkVudW1zO1xuY29uc3QgeyB0cnlSZXF1aXJlIH0gPSByZXF1aXJlKCdAZ2VueC9hcHAvbGliL3V0aWxzL0hlbHBlcnMnKTtcbmNvbnN0IHsgSW52YWxpZENvbmZpZ3VyYXRpb24gfSA9IHJlcXVpcmUoJ0BnZW54L2Vycm9yJyk7XG5jb25zdCB7IGZzIH0gPSByZXF1aXJlKCdyay11dGlscycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuICAgIC8qKlxuICAgICAqIFRoaXMgZmVhdHVyZSBpcyBsb2FkZWQgYXQgc2VydmljZSBzdGFnZVxuICAgICAqIEBtZW1iZXIge3N0cmluZ31cbiAgICAgKi9cbiAgICB0eXBlOiBGZWF0dXJlLlNFUlZJQ0UsXG5cbiAgICAvKipcbiAgICAgKiBMb2FkIHRoZSBmZWF0dXJlXG4gICAgICogQHBhcmFtIHtBcHB9IGFwcCAtIFRoZSBhcHAgbW9kdWxlIG9iamVjdFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucyBmb3IgdGhlIGZlYXR1cmVcbiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gb3B0aW9ucy5zZXJ2aWNlQWNjb3VudCAtIFRoZSBzZXJpdmNlQWNjb3VudCBjb25maWcgZmlsZSBwYXRoLlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjwqPn1cbiAgICAgKi9cbiAgICBsb2FkXzogYXN5bmMgZnVuY3Rpb24gKGFwcCwgb3B0aW9ucykge1xuICAgICAgICBpZiAoIW9wdGlvbnMgfHwgdHlwZW9mIG9wdGlvbnMuc2VydmljZUFjY291bnQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZENvbmZpZ3VyYXRpb24oJ01pc3NpbmcgcmVxdWlyZWQgY29uZmlndXJhdGlvbiBpdGVtIFwiZmlyZWJhc2Uuc2VydmljZUFjY291bnRcIi4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFkbWluID0gdHJ5UmVxdWlyZSgnZmlyZWJhc2UtYWRtaW4nKTtcblxuICAgICAgICBjb25zdCBzZXJ2aWNlQWNjb3VudCA9IGF3YWl0IGZzLnJlYWRKc29uKG9wdGlvbnMuc2VydmljZUFjY291bnQsICd1dGY4Jyk7XG5cbiAgICAgICAgY29uc3QgZmlyZWJhc2VBZG1pbkFwcCA9IGFkbWluLmluaXRpYWxpemVBcHAoe1xuICAgICAgICAgICAgY3JlZGVudGlhbDogYWRtaW4uY3JlZGVudGlhbC5jZXJ0KHNlcnZpY2VBY2NvdW50KVxuICAgICAgICB9KTtcblxuICAgICAgICBhcHAucmVnaXN0ZXJTZXJ2aWNlKCdmaXJlYmFzZUFkbWluJywgZmlyZWJhc2VBZG1pbkFwcCk7XG4gICAgfVxufTsiXX0=