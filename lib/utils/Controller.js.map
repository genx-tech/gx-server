{"version":3,"sources":["../../src/utils/Controller.js"],"names":["require","Controller","constructor","app","apiWrapper","getService","settings","apiWrapperService","ApplicationError","db","name","send","ctx","result","payload","body","wrapResult","cache","key","factory","_cache","value","module","exports"],"mappings":";;;;AAAA,MAAM,KAAOA,OAAO,CAAC,aAAD,CAApB;;AAEA,MAAMC,UAAN,CAAiB;AACbC,EAAAA,WAAW,CAACC,GAAD,EAAM;AACb,SAAKA,GAAL,GAAWA,GAAX;AACA,SAAKC,UAAL,GAAkB,KAAKD,GAAL,CAASE,UAAT,CAAoB,KAAKF,GAAL,CAASG,QAAT,CAAkBC,iBAAlB,IAAuC,YAA3D,CAAlB;;AAEA,QAAI,CAAC,KAAKH,UAAV,EAAsB;AAClB,YAAM,IAAII,gBAAJ,CAAqB,oEAArB,CAAN;AACH;AACJ;;AAEDC,EAAAA,EAAE,CAACC,IAAD,EAAO;AACL,WAAO,KAAKP,GAAL,CAASM,EAAT,CAAYC,IAAI,IAAI,KAAKP,GAAL,CAASG,QAAT,CAAkBG,EAAtC,CAAP;AACH;;AAEDE,EAAAA,IAAI,CAACC,GAAD,EAAMC,MAAN,EAAcC,OAAd,EAAuB;AACvBF,IAAAA,GAAG,CAACG,IAAJ,GAAW,KAAKX,UAAL,CAAgBY,UAAhB,CAA2BJ,GAA3B,EAAgCC,MAAhC,EAAwCC,OAAxC,CAAX;AACH;;AAEDG,EAAAA,KAAK,CAACC,GAAD,EAAMC,OAAN,EAAe;AAChB,QAAI,CAAC,KAAKC,MAAV,EAAkB;AACd,WAAKA,MAAL,GAAc,EAAd;AACH;;AAED,QAAIC,KAAK,GAAG,KAAKD,MAAL,CAAYF,GAAZ,CAAZ;;AACA,QAAIG,KAAK,IAAI,IAAb,EAAmB;AACfA,MAAAA,KAAK,GAAG,KAAKD,MAAL,CAAYF,GAAZ,IAAmBC,OAAO,EAAlC;AACH;;AAED,WAAOE,KAAP;AACH;;AA7BY;;AAgCjBC,MAAM,CAACC,OAAP,GAAiBtB,UAAjB","sourcesContent":["const {  } = require('@genx/error');\n\nclass Controller {\n    constructor(app) {\n        this.app = app;\n        this.apiWrapper = this.app.getService(this.app.settings.apiWrapperService || 'apiWrapper');\n\n        if (!this.apiWrapper) {\n            throw new ApplicationError('\"apiWrapper\" service is required when using the Controller helper.');\n        }\n    }\n\n    db(name) {\n        return this.app.db(name || this.app.settings.db);\n    }\n\n    send(ctx, result, payload) {\n        ctx.body = this.apiWrapper.wrapResult(ctx, result, payload);\n    }\n\n    cache(key, factory) {\n        if (!this._cache) {\n            this._cache = {};\n        }\n\n        let value = this._cache[key];\n        if (value == null) {\n            value = this._cache[key] = factory();\n        }\n\n        return value;\n    }\n}\n\nmodule.exports = Controller;\n"],"file":"Controller.js"}