{"version":3,"file":"action.js","names":["require","path","InvalidConfiguration","Literal","module","exports","controllerAction","app","pos","lastIndexOf","controller","substr","action","controllerBasePath","join","backendPath","CONTROLLERS_PATH","controllerPath","resolve","ctrl","actioner","Array","isArray","actionFunction","concat","pop"],"sources":["../../src/middlewares/action.js"],"sourcesContent":["\"use strict\";\n\n/**\n * Response action as middleware\n * @module Middleware_Action\n */\n\nconst path = require('path');\nconst { InvalidConfiguration } = require('@genx/error');\nconst Literal = require('../enum/Literal');\n\n/**\n * Action middleware creator\n * @param {string} controllerAction \n * @param {Routable} app \n */\nmodule.exports = (controllerAction, app) => {\n    if (typeof controllerAction !== 'string') {\n        throw new InvalidConfiguration('Invalid action syntax.', app);\n    }\n\n    let pos = controllerAction.lastIndexOf('.');\n    if (pos < 0) {\n        throw new InvalidConfiguration(`Unrecognized controller & action syntax: ${controllerAction}.`, app);\n    }\n\n    let controller = controllerAction.substr(0, pos);\n    let action = controllerAction.substr(pos + 1);\n    let controllerBasePath = path.join(app.backendPath, Literal.CONTROLLERS_PATH);\n\n    let controllerPath = path.resolve(controllerBasePath, controller + '.js');\n    let ctrl = require(controllerPath);    \n\n    let actioner = ctrl[action];   \n\n    if (Array.isArray(actioner)) {\n        let actionFunction = actioner.concat().pop();\n        if (typeof actionFunction !== 'function') {\n            throw new InvalidConfiguration(`${controllerAction} does not contain a valid action in returned middleware chain.`, app);\n        }    \n\n        return actioner.concat(actionFunction);\n    } \n\n    if (typeof actioner !== 'function') {\n        throw new InvalidConfiguration(`${controllerAction} is not a valid action.`, app);\n    }    \n\n    return actioner;\n};"],"mappings":"AAAA,YAAY;AAACA,OAAA;AAOb,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAM;EAAEE;AAAqB,CAAC,GAAGF,OAAO,CAAC,aAAa,CAAC;AACvD,MAAMG,OAAO,GAAGH,OAAO,CAAC,iBAAiB,CAAC;AAO1CI,MAAM,CAACC,OAAO,GAAG,CAACC,gBAAgB,EAAEC,GAAG,KAAK;EACxC,IAAI,OAAOD,gBAAgB,KAAK,QAAQ,EAAE;IACtC,MAAM,IAAIJ,oBAAoB,CAAC,wBAAwB,EAAEK,GAAG,CAAC;EACjE;EAEA,IAAIC,GAAG,GAAGF,gBAAgB,CAACG,WAAW,CAAC,GAAG,CAAC;EAC3C,IAAID,GAAG,GAAG,CAAC,EAAE;IACT,MAAM,IAAIN,oBAAoB,CAAE,4CAA2CI,gBAAiB,GAAE,EAAEC,GAAG,CAAC;EACxG;EAEA,IAAIG,UAAU,GAAGJ,gBAAgB,CAACK,MAAM,CAAC,CAAC,EAAEH,GAAG,CAAC;EAChD,IAAII,MAAM,GAAGN,gBAAgB,CAACK,MAAM,CAACH,GAAG,GAAG,CAAC,CAAC;EAC7C,IAAIK,kBAAkB,GAAGZ,IAAI,CAACa,IAAI,CAACP,GAAG,CAACQ,WAAW,EAAEZ,OAAO,CAACa,gBAAgB,CAAC;EAE7E,IAAIC,cAAc,GAAGhB,IAAI,CAACiB,OAAO,CAACL,kBAAkB,EAAEH,UAAU,GAAG,KAAK,CAAC;EACzE,IAAIS,IAAI,GAAGnB,OAAO,CAACiB,cAAc,CAAC;EAElC,IAAIG,QAAQ,GAAGD,IAAI,CAACP,MAAM,CAAC;EAE3B,IAAIS,KAAK,CAACC,OAAO,CAACF,QAAQ,CAAC,EAAE;IACzB,IAAIG,cAAc,GAAGH,QAAQ,CAACI,MAAM,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC;IAC5C,IAAI,OAAOF,cAAc,KAAK,UAAU,EAAE;MACtC,MAAM,IAAIrB,oBAAoB,CAAE,GAAEI,gBAAiB,gEAA+D,EAAEC,GAAG,CAAC;IAC5H;IAEA,OAAOa,QAAQ,CAACI,MAAM,CAACD,cAAc,CAAC;EAC1C;EAEA,IAAI,OAAOH,QAAQ,KAAK,UAAU,EAAE;IAChC,MAAM,IAAIlB,oBAAoB,CAAE,GAAEI,gBAAiB,yBAAwB,EAAEC,GAAG,CAAC;EACrF;EAEA,OAAOa,QAAQ;AACnB,CAAC"}