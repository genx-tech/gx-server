{"version":3,"sources":["../../src/middlewares/passportCheck.js"],"names":["HttpCode","require","module","exports","options","app","ctx","next","isAuthenticated","successReturnToOrRedirect","session","returnTo","originalUrl","url","loginUrl","throw","UNAUTHORIZED","redirect"],"mappings":"AAAA;;;;AAOA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,mBAAD,CAAxB;;AASAC,MAAM,CAACC,OAAP,GAAiB,CAACC,OAAD,EAAUC,GAAV,KAAkB;AAC/B,SAAO,OAAOC,GAAP,EAAYC,IAAZ,KAAqB;AACxB,QAAID,GAAG,CAACE,eAAJ,EAAJ,EAA2B;AACvB,aAAOD,IAAI,EAAX;AACH;;AAED,QAAIH,OAAO,CAACK,yBAAR,IAAqCH,GAAG,CAACI,OAA7C,EAAsD;AAClDJ,MAAAA,GAAG,CAACI,OAAJ,CAAYC,QAAZ,GAAuBL,GAAG,CAACM,WAAJ,IAAmBN,GAAG,CAACO,GAA9C;AACH;;AAED,QAAI,CAACT,OAAO,CAACU,QAAb,EAAuB;AACnBR,MAAAA,GAAG,CAACS,KAAJ,CAAUf,QAAQ,CAACgB,YAAnB,EAAiC,yBAAjC;AACH;;AAED,WAAOV,GAAG,CAACW,QAAJ,CAAab,OAAO,CAACU,QAArB,CAAP;AACH,GAdD;AAeH,CAhBD","sourcesContent":["\"use strict\";\n\n/**\n * Middleware to check user logged in status based on passport\n * @module Middleware_PassportCheck\n */\n\nconst HttpCode = require('http-status-codes');\n\n/**\n * Initialize ensureLoggedIn middleware\n * @param {object} options\n * @property {string} [options.loginUrl] - If given, will redirect to loginUrl if not loggedIn\n * @property {boolean} [options.successReturnToOrRedirect] - If given, will redirect to loginUrl if not loggedIn \n * @param {Routable} app\n */  \nmodule.exports = (options, app) => {\n    return async (ctx, next) => {\n        if (ctx.isAuthenticated()) {\n            return next();\n        }\n\n        if (options.successReturnToOrRedirect && ctx.session) {\n            ctx.session.returnTo = ctx.originalUrl || ctx.url;            \n        }\n\n        if (!options.loginUrl) {\n            ctx.throw(HttpCode.UNAUTHORIZED, 'authentication required');\n        }\n\n        return ctx.redirect(options.loginUrl);\n    }\n};"],"file":"passportCheck.js"}