{"version":3,"sources":["../../src/routers/graphql.js"],"names":["path","require","InvalidConfiguration","Koa","mount","module","exports","app","baseRoute","options","graphqlHTTP","tryRequire","middlewares","schemaProvider","graphqlOpts","schemaFactory","resolve","backendPath","schemaObj","schema","rootValue","router","useMiddlewares","use","mountRouter"],"mappings":"AAAA;;;;AAEA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAA2BD,OAAO,CAAC,aAAD,CAAxC;;AACA,MAAME,GAAG,GAAGF,OAAO,CAAC,KAAD,CAAnB;;AACA,MAAMG,KAAK,GAAGH,OAAO,CAAC,WAAD,CAArB;;AAyBAI,MAAM,CAACC,OAAP,GAAiB,OAAOC,GAAP,EAAYC,SAAZ,EAAuBC,OAAvB,KAAmC;AAChD,QAAMC,WAAW,GAAGH,GAAG,CAACI,UAAJ,CAAe,aAAf,CAApB;AAEA,QAAM;AAAEC,IAAAA,WAAF;AAAeC,IAAAA,cAAf;AAA+B,OAAGC;AAAlC,MAAkDL,OAAxD;;AAEA,MAAI,CAACI,cAAL,EAAqB;AACjB,UAAM,IAAIX,oBAAJ,CACF,gCADE,EAEFK,GAFE,EAGD,WAAUC,SAAU,yBAHnB,CAAN;AAKH;;AAED,QAAMO,aAAa,GAAGd,OAAO,CAACD,IAAI,CAACgB,OAAL,CAAaT,GAAG,CAACU,WAAjB,EAA8BJ,cAA9B,CAAD,CAA7B;;AACA,QAAMK,SAAS,GAAG,MAAMH,aAAa,CAACR,GAAD,CAArC;;AAEA,MAAI,CAACW,SAAS,CAACC,MAAf,EAAuB;AACnB,UAAM,IAAIjB,oBAAJ,CACF,0EADE,EAEFK,GAFE,EAGD,WAAUC,SAAU,yBAHnB,CAAN;AAKH;;AAEDM,EAAAA,WAAW,CAACK,MAAZ,GAAqBD,SAAS,CAACC,MAA/B;;AACA,MAAID,SAAS,CAACE,SAAd,EAAyB;AACrBN,IAAAA,WAAW,CAACM,SAAZ,GAAwBF,SAAS,CAACE,SAAlC;AACH;;AAED,MAAIC,MAAM,GAAG,IAAIlB,GAAJ,EAAb;;AAEA,MAAIS,WAAJ,EAAiB;AACbL,IAAAA,GAAG,CAACe,cAAJ,CAAmBD,MAAnB,EAA2BT,WAA3B;AACH;;AAEDS,EAAAA,MAAM,CAACE,GAAP,CAAWnB,KAAK,CAAC,GAAD,EAAMM,WAAW,CAACI,WAAD,CAAjB,CAAhB;AACAP,EAAAA,GAAG,CAACiB,WAAJ,CAAgBhB,SAAhB,EAA2Ba,MAA3B;AACH,CArCD","sourcesContent":["\"use strict\";\n\nconst path = require('path');\nconst { InvalidConfiguration } = require('@genx/error');\nconst Koa = require('koa');\nconst mount = require('koa-mount');\n\n/**\n * GraphQL router.\n * @module Router_GraphQL\n */\n\n/**\n * Create a GraphQL router.\n * @param {*} app \n * @param {string} baseRoute \n * @param {objects} options \n * @property {string} options.schema\n * @property {object|array} [options.middlewares]\n * @property {boolean} [options.graphiql]\n * @example\n *  '<base path>': {\n *      graphql: {          \n *          middlewares: {},\n *          schema: 'graphql/schema',\n *          rootValue: '',\n *          graphiql: true\n *      }\n *  }\n */\nmodule.exports = async (app, baseRoute, options) => {\n    const graphqlHTTP = app.tryRequire('koa-graphql');        \n\n    const { middlewares, schemaProvider, ...graphqlOpts } = options;\n\n    if (!schemaProvider) {\n        throw new InvalidConfiguration(\n            'Missing schemaProvider config.',\n            app,\n            `routing.${baseRoute}.graphql.schemaProvider`\n        );\n    }\n\n    const schemaFactory = require(path.resolve(app.backendPath, schemaProvider));\n    const schemaObj = await schemaFactory(app);\n\n    if (!schemaObj.schema) {\n        throw new InvalidConfiguration(\n            'The object returned from schemaProvider doesnot contain the schema body.',\n            app,\n            `routing.${baseRoute}.graphql.schemaProvider`\n        );\n    }\n \n    graphqlOpts.schema = schemaObj.schema;\n    if (schemaObj.rootValue) {\n        graphqlOpts.rootValue = schemaObj.rootValue;\n    }\n    \n    let router = new Koa();\n\n    if (middlewares) {\n        app.useMiddlewares(router, middlewares);\n    }\n\n    router.use(mount('/', graphqlHTTP(graphqlOpts)));\n    app.mountRouter(baseRoute, router);\n};"],"file":"graphql.js"}