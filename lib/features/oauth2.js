"use strict";

require("source-map-support/register");

const path = require('path');

const {
  Feature
} = require('..').Enums;

const {
  dependsOn
} = require('@genx/app/lib/utils/Helpers');

module.exports = {
  type: Feature.PLUGIN,
  load_: function (app, config) {
    dependsOn('passport', app, 'oauth2');
    const oauth2orize = app.tryRequire('oauth2orize-koa');
    const server = oauth2orize.createServer();
    let strategy, strategyScript;

    try {
      strategyScript = path.join(app.backendPath, 'oauth2', 'strategy.js');

      let strategyInitiator = require(strategyScript);

      strategy = strategyInitiator(app, server);

      if (!strategy) {
        throw new Error(`Invalid oauth2 strategy.`);
      }
    } catch (error) {
      if (error.code === 'MODULE_NOT_FOUND') {
        throw new Error(`oauth2 strategy file "${strategyScript}" not found.`);
      }

      throw error;
    }

    server.serializeClient(strategy.serializeClient);
    server.deserializeClient(strategy.deserializeClient);
    server.grant(oauth2orize.grant.code(strategy.grantCode));
    server.exchange(oauth2orize.exchange.code(strategy.exchangeCode));
    app.registerMiddlewareFactory('oauth2Authorization', () => ["passportCheck", server.authorize(strategy.authorize)]);
    app.registerMiddlewareFactory('oauth2Decision', () => ["passportCheck", server.decision()]);
    app.registerMiddlewareFactory('oauth2Token', () => [["passportAuth", {
      "strategy": ['basic', 'oauth2-client-password'],
      "options": {
        session: false
      }
    }], server.token(), server.errorHandler()]);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9vYXV0aDIuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJGZWF0dXJlIiwiRW51bXMiLCJkZXBlbmRzT24iLCJtb2R1bGUiLCJleHBvcnRzIiwidHlwZSIsIlBMVUdJTiIsImxvYWRfIiwiYXBwIiwiY29uZmlnIiwib2F1dGgyb3JpemUiLCJ0cnlSZXF1aXJlIiwic2VydmVyIiwiY3JlYXRlU2VydmVyIiwic3RyYXRlZ3kiLCJzdHJhdGVneVNjcmlwdCIsImpvaW4iLCJiYWNrZW5kUGF0aCIsInN0cmF0ZWd5SW5pdGlhdG9yIiwiRXJyb3IiLCJlcnJvciIsImNvZGUiLCJzZXJpYWxpemVDbGllbnQiLCJkZXNlcmlhbGl6ZUNsaWVudCIsImdyYW50IiwiZ3JhbnRDb2RlIiwiZXhjaGFuZ2UiLCJleGNoYW5nZUNvZGUiLCJyZWdpc3Rlck1pZGRsZXdhcmVGYWN0b3J5IiwiYXV0aG9yaXplIiwiZGVjaXNpb24iLCJzZXNzaW9uIiwidG9rZW4iLCJlcnJvckhhbmRsZXIiXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBT0EsTUFBTUEsSUFBSSxHQUFHQyxPQUFPLENBQUMsTUFBRCxDQUFwQjs7QUFDQSxNQUFNO0FBQUVDLEVBQUFBO0FBQUYsSUFBY0QsT0FBTyxDQUFDLElBQUQsQ0FBUCxDQUFjRSxLQUFsQzs7QUFDQSxNQUFNO0FBQUVDLEVBQUFBO0FBQUYsSUFBZ0JILE9BQU8sQ0FBQyw2QkFBRCxDQUE3Qjs7QUFFQUksTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBTWJDLEVBQUFBLElBQUksRUFBRUwsT0FBTyxDQUFDTSxNQU5EO0FBY2JDLEVBQUFBLEtBQUssRUFBRSxVQUFVQyxHQUFWLEVBQWVDLE1BQWYsRUFBdUI7QUFDMUJQLElBQUFBLFNBQVMsQ0FBQyxVQUFELEVBQWFNLEdBQWIsRUFBa0IsUUFBbEIsQ0FBVDtBQWVBLFVBQU1FLFdBQVcsR0FBR0YsR0FBRyxDQUFDRyxVQUFKLENBQWUsaUJBQWYsQ0FBcEI7QUFHQSxVQUFNQyxNQUFNLEdBQUdGLFdBQVcsQ0FBQ0csWUFBWixFQUFmO0FBRUEsUUFBSUMsUUFBSixFQUFjQyxjQUFkOztBQUVBLFFBQUk7QUFDQUEsTUFBQUEsY0FBYyxHQUFHakIsSUFBSSxDQUFDa0IsSUFBTCxDQUFVUixHQUFHLENBQUNTLFdBQWQsRUFBMkIsUUFBM0IsRUFBcUMsYUFBckMsQ0FBakI7O0FBQ0EsVUFBSUMsaUJBQWlCLEdBQUduQixPQUFPLENBQUNnQixjQUFELENBQS9COztBQUNBRCxNQUFBQSxRQUFRLEdBQUdJLGlCQUFpQixDQUFDVixHQUFELEVBQU1JLE1BQU4sQ0FBNUI7O0FBRUEsVUFBSSxDQUFDRSxRQUFMLEVBQWU7QUFDWCxjQUFNLElBQUlLLEtBQUosQ0FBVywwQkFBWCxDQUFOO0FBQ0g7QUFDSixLQVJELENBUUUsT0FBT0MsS0FBUCxFQUFjO0FBQ1osVUFBSUEsS0FBSyxDQUFDQyxJQUFOLEtBQWUsa0JBQW5CLEVBQXVDO0FBQ25DLGNBQU0sSUFBSUYsS0FBSixDQUFXLHlCQUF3QkosY0FBZSxjQUFsRCxDQUFOO0FBQ0g7O0FBRUQsWUFBTUssS0FBTjtBQUNIOztBQWVEUixJQUFBQSxNQUFNLENBQUNVLGVBQVAsQ0FBdUJSLFFBQVEsQ0FBQ1EsZUFBaEM7QUFFQVYsSUFBQUEsTUFBTSxDQUFDVyxpQkFBUCxDQUF5QlQsUUFBUSxDQUFDUyxpQkFBbEM7QUFnQkFYLElBQUFBLE1BQU0sQ0FBQ1ksS0FBUCxDQUFhZCxXQUFXLENBQUNjLEtBQVosQ0FBa0JILElBQWxCLENBQXVCUCxRQUFRLENBQUNXLFNBQWhDLENBQWI7QUFRQWIsSUFBQUEsTUFBTSxDQUFDYyxRQUFQLENBQWdCaEIsV0FBVyxDQUFDZ0IsUUFBWixDQUFxQkwsSUFBckIsQ0FBMEJQLFFBQVEsQ0FBQ2EsWUFBbkMsQ0FBaEI7QUFrQkFuQixJQUFBQSxHQUFHLENBQUNvQix5QkFBSixDQUE4QixxQkFBOUIsRUFBcUQsTUFBTSxDQUN2RCxlQUR1RCxFQUV0RGhCLE1BQU0sQ0FBQ2lCLFNBQVAsQ0FBaUJmLFFBQVEsQ0FBQ2UsU0FBMUIsQ0FGc0QsQ0FBM0Q7QUFZQXJCLElBQUFBLEdBQUcsQ0FBQ29CLHlCQUFKLENBQThCLGdCQUE5QixFQUFnRCxNQUFNLENBQ2xELGVBRGtELEVBRWpEaEIsTUFBTSxDQUFDa0IsUUFBUCxFQUZpRCxDQUF0RDtBQVlBdEIsSUFBQUEsR0FBRyxDQUFDb0IseUJBQUosQ0FBOEIsYUFBOUIsRUFBNkMsTUFBTSxDQUMvQyxDQUNJLGNBREosRUFDb0I7QUFDWixrQkFBWSxDQUFDLE9BQUQsRUFBVSx3QkFBVixDQURBO0FBRVosaUJBQVk7QUFBRUcsUUFBQUEsT0FBTyxFQUFFO0FBQVg7QUFGQSxLQURwQixDQUQrQyxFQU8vQ25CLE1BQU0sQ0FBQ29CLEtBQVAsRUFQK0MsRUFRL0NwQixNQUFNLENBQUNxQixZQUFQLEVBUitDLENBQW5EO0FBVUg7QUFoSlksQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBFbmFibGUgb2F1dGgyIGZlYXR1cmVcbiAqIEBtb2R1bGUgRmVhdHVyZV9PQXV0aDJcbiAqL1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgeyBGZWF0dXJlIH0gPSByZXF1aXJlKCcuLicpLkVudW1zO1xuY29uc3QgeyBkZXBlbmRzT24gfSA9IHJlcXVpcmUoJ0BnZW54L2FwcC9saWIvdXRpbHMvSGVscGVycycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuICAgIC8qKlxuICAgICAqIFRoaXMgZmVhdHVyZSBpcyBsb2FkZWQgYXQgc2VydmljZSBzdGFnZVxuICAgICAqIEBtZW1iZXIge3N0cmluZ31cbiAgICAgKi9cbiAgICB0eXBlOiBGZWF0dXJlLlBMVUdJTixcblxuICAgIC8qKlxuICAgICAqIExvYWQgdGhlIGZlYXR1cmVcbiAgICAgKiBAcGFyYW0ge1JvdXRhYmxlfSBhcHAgLSBUaGUgYXBwIG1vZHVsZSBvYmplY3RcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gY29uZmlnIC0gUGFzc3BvcnQgY29uZmlnXG4gICAgICogQHJldHVybnMge1Byb21pc2UuPCo+fVxuICAgICAqL1xuICAgIGxvYWRfOiBmdW5jdGlvbiAoYXBwLCBjb25maWcpIHtcbiAgICAgICAgZGVwZW5kc09uKCdwYXNzcG9ydCcsIGFwcCwgJ29hdXRoMicpO1xuXG4gICAgICAgIC8qXG4gICAgICAgIGxldCBwYXNzcG9ydCA9IGFwcC5nZXRTZXJ2aWNlKCdwYXNzcG9ydCcpO1xuICAgICAgICBpZiAoIXBhc3Nwb3J0Lmhhc1N0cmF0ZWd5KCdiYXNpYycpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ29hdXRoMiByZXF1aXJlcyBcImJhc2ljXCIgcGFzc3BvcnQgc3RyYXRlZ3kuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXBhc3Nwb3J0Lmhhc1N0cmF0ZWd5KCdvYXV0aDItY2xpZW50LXBhc3N3b3JkJykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignb2F1dGgyIHJlcXVpcmVzIFwib2F1dGgyLWNsaWVudC1wYXNzd29yZFwiIHBhc3Nwb3J0IHN0cmF0ZWd5LicpO1xuICAgICAgICB9Ki9cblxuICAgICAgICAvKipcbiAgICAgICAgICogTW9kdWxlIGRlcGVuZGVuY2llcy5cbiAgICAgICAgICovICAgICAgICBcbiAgICAgICAgY29uc3Qgb2F1dGgyb3JpemUgPSBhcHAudHJ5UmVxdWlyZSgnb2F1dGgyb3JpemUta29hJyk7ICAgICAgICBcblxuICAgICAgICAvLyBjcmVhdGUgT0F1dGggMi4wIHNlcnZlclxuICAgICAgICBjb25zdCBzZXJ2ZXIgPSBvYXV0aDJvcml6ZS5jcmVhdGVTZXJ2ZXIoKTsgICAgICAgIFxuXG4gICAgICAgIGxldCBzdHJhdGVneSwgc3RyYXRlZ3lTY3JpcHQ7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHN0cmF0ZWd5U2NyaXB0ID0gcGF0aC5qb2luKGFwcC5iYWNrZW5kUGF0aCwgJ29hdXRoMicsICdzdHJhdGVneS5qcycpO1xuICAgICAgICAgICAgbGV0IHN0cmF0ZWd5SW5pdGlhdG9yID0gcmVxdWlyZShzdHJhdGVneVNjcmlwdCk7XG4gICAgICAgICAgICBzdHJhdGVneSA9IHN0cmF0ZWd5SW5pdGlhdG9yKGFwcCwgc2VydmVyKTtcblxuICAgICAgICAgICAgaWYgKCFzdHJhdGVneSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBvYXV0aDIgc3RyYXRlZ3kuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ01PRFVMRV9OT1RfRk9VTkQnKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBvYXV0aDIgc3RyYXRlZ3kgZmlsZSBcIiR7c3RyYXRlZ3lTY3JpcHR9XCIgbm90IGZvdW5kLmApXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVnaXN0ZXIgc2VyaWFsaWFsaXphdGlvbiBhbmQgZGVzZXJpYWxpemF0aW9uIGZ1bmN0aW9ucy5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gV2hlbiBhIGNsaWVudCByZWRpcmVjdHMgYSB1c2VyIHRvIHVzZXIgYXV0aG9yaXphdGlvbiBlbmRwb2ludCwgYW5cbiAgICAgICAgLy8gYXV0aG9yaXphdGlvbiB0cmFuc2FjdGlvbiBpcyBpbml0aWF0ZWQuICBUbyBjb21wbGV0ZSB0aGUgdHJhbnNhY3Rpb24sIHRoZVxuICAgICAgICAvLyB1c2VyIG11c3QgYXV0aGVudGljYXRlIGFuZCBhcHByb3ZlIHRoZSBhdXRob3JpemF0aW9uIHJlcXVlc3QuICBCZWNhdXNlIHRoaXNcbiAgICAgICAgLy8gbWF5IGludm9sdmUgbXVsdGlwbGUgSFRUUCByZXF1ZXN0L3Jlc3BvbnNlIGV4Y2hhbmdlcywgdGhlIHRyYW5zYWN0aW9uIGlzXG4gICAgICAgIC8vIHN0b3JlZCBpbiB0aGUgc2Vzc2lvbi5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gQW4gYXBwbGljYXRpb24gbXVzdCBzdXBwbHkgc2VyaWFsaXphdGlvbiBmdW5jdGlvbnMsIHdoaWNoIGRldGVybWluZSBob3cgdGhlXG4gICAgICAgIC8vIGNsaWVudCBvYmplY3QgaXMgc2VyaWFsaXplZCBpbnRvIHRoZSBzZXNzaW9uLiAgVHlwaWNhbGx5IHRoaXMgd2lsbCBiZSBhXG4gICAgICAgIC8vIHNpbXBsZSBtYXR0ZXIgb2Ygc2VyaWFsaXppbmcgdGhlIGNsaWVudCdzIElELCBhbmQgZGVzZXJpYWxpemluZyBieSBmaW5kaW5nXG4gICAgICAgIC8vIHRoZSBjbGllbnQgYnkgSUQgZnJvbSB0aGUgZGF0YWJhc2UuXG5cbiAgICAgICAgc2VydmVyLnNlcmlhbGl6ZUNsaWVudChzdHJhdGVneS5zZXJpYWxpemVDbGllbnQpO1xuXG4gICAgICAgIHNlcnZlci5kZXNlcmlhbGl6ZUNsaWVudChzdHJhdGVneS5kZXNlcmlhbGl6ZUNsaWVudCk7XG5cbiAgICAgICAgLy8gUmVnaXN0ZXIgc3VwcG9ydGVkIGdyYW50IHR5cGVzLlxuICAgICAgICAvL1xuICAgICAgICAvLyBPQXV0aCAyLjAgc3BlY2lmaWVzIGEgZnJhbWV3b3JrIHRoYXQgYWxsb3dzIHVzZXJzIHRvIGdyYW50IGNsaWVudFxuICAgICAgICAvLyBhcHBsaWNhdGlvbnMgbGltaXRlZCBhY2Nlc3MgdG8gdGhlaXIgcHJvdGVjdGVkIHJlc291cmNlcy4gIEl0IGRvZXMgdGhpc1xuICAgICAgICAvLyB0aHJvdWdoIGEgcHJvY2VzcyBvZiB0aGUgdXNlciBncmFudGluZyBhY2Nlc3MsIGFuZCB0aGUgY2xpZW50IGV4Y2hhbmdpbmdcbiAgICAgICAgLy8gdGhlIGdyYW50IGZvciBhbiBhY2Nlc3MgdG9rZW4uXG5cbiAgICAgICAgLy8gR3JhbnQgYXV0aG9yaXphdGlvbiBjb2Rlcy4gIFRoZSBjYWxsYmFjayB0YWtlcyB0aGUgYGNsaWVudGAgcmVxdWVzdGluZ1xuICAgICAgICAvLyBhdXRob3JpemF0aW9uLCB0aGUgYHJlZGlyZWN0VVJJYCAod2hpY2ggaXMgdXNlZCBhcyBhIHZlcmlmaWVyIGluIHRoZVxuICAgICAgICAvLyBzdWJzZXF1ZW50IGV4Y2hhbmdlKSwgdGhlIGF1dGhlbnRpY2F0ZWQgYHVzZXJgIGdyYW50aW5nIGFjY2VzcywgYW5kXG4gICAgICAgIC8vIHRoZWlyIHJlc3BvbnNlLCB3aGljaCBjb250YWlucyBhcHByb3ZlZCBzY29wZSwgZHVyYXRpb24sIGV0Yy4gYXMgcGFyc2VkIGJ5XG4gICAgICAgIC8vIHRoZSBhcHBsaWNhdGlvbi4gIFRoZSBhcHBsaWNhdGlvbiBpc3N1ZXMgYSBjb2RlLCB3aGljaCBpcyBib3VuZCB0byB0aGVzZVxuICAgICAgICAvLyB2YWx1ZXMsIGFuZCB3aWxsIGJlIGV4Y2hhbmdlZCBmb3IgYW4gYWNjZXNzIHRva2VuLlxuXG4gICAgICAgIHNlcnZlci5ncmFudChvYXV0aDJvcml6ZS5ncmFudC5jb2RlKHN0cmF0ZWd5LmdyYW50Q29kZSkpO1xuXG4gICAgICAgIC8vIEV4Y2hhbmdlIGF1dGhvcml6YXRpb24gY29kZXMgZm9yIGFjY2VzcyB0b2tlbnMuICBUaGUgY2FsbGJhY2sgYWNjZXB0cyB0aGVcbiAgICAgICAgLy8gYGNsaWVudGAsIHdoaWNoIGlzIGV4Y2hhbmdpbmcgYGNvZGVgIGFuZCBhbnkgYHJlZGlyZWN0VVJJYCBmcm9tIHRoZVxuICAgICAgICAvLyBhdXRob3JpemF0aW9uIHJlcXVlc3QgZm9yIHZlcmlmaWNhdGlvbi4gIElmIHRoZXNlIHZhbHVlcyBhcmUgdmFsaWRhdGVkLCB0aGVcbiAgICAgICAgLy8gYXBwbGljYXRpb24gaXNzdWVzIGFuIGFjY2VzcyB0b2tlbiBvbiBiZWhhbGYgb2YgdGhlIHVzZXIgd2hvIGF1dGhvcml6ZWQgdGhlXG4gICAgICAgIC8vIGNvZGUuXG5cbiAgICAgICAgc2VydmVyLmV4Y2hhbmdlKG9hdXRoMm9yaXplLmV4Y2hhbmdlLmNvZGUoc3RyYXRlZ3kuZXhjaGFuZ2VDb2RlKSk7XG5cbiAgICAgICAgLy8gdXNlciBhdXRob3JpemF0aW9uIGVuZHBvaW50XG4gICAgICAgIC8vXG4gICAgICAgIC8vIGBhdXRob3JpemF0aW9uYCBtaWRkbGV3YXJlIGFjY2VwdHMgYSBgdmFsaWRhdGVgIGNhbGxiYWNrIHdoaWNoIGlzXG4gICAgICAgIC8vIHJlc3BvbnNpYmxlIGZvciB2YWxpZGF0aW5nIHRoZSBjbGllbnQgbWFraW5nIHRoZSBhdXRob3JpemF0aW9uIHJlcXVlc3QuICBJblxuICAgICAgICAvLyBkb2luZyBzbywgaXMgcmVjb21tZW5kZWQgdGhhdCB0aGUgYHJlZGlyZWN0VVJJYCBiZSBjaGVja2VkIGFnYWluc3QgYVxuICAgICAgICAvLyByZWdpc3RlcmVkIHZhbHVlLCBhbHRob3VnaCBzZWN1cml0eSByZXF1aXJlbWVudHMgbWF5IHZhcnkgYWNjcm9zc1xuICAgICAgICAvLyBpbXBsZW1lbnRhdGlvbnMuICBPbmNlIHZhbGlkYXRlZCwgdGhlIGBkb25lYCBjYWxsYmFjayBtdXN0IGJlIGludm9rZWQgd2l0aFxuICAgICAgICAvLyBhIGBjbGllbnRgIGluc3RhbmNlLCBhcyB3ZWxsIGFzIHRoZSBgcmVkaXJlY3RVUklgIHRvIHdoaWNoIHRoZSB1c2VyIHdpbGwgYmVcbiAgICAgICAgLy8gcmVkaXJlY3RlZCBhZnRlciBhbiBhdXRob3JpemF0aW9uIGRlY2lzaW9uIGlzIG9idGFpbmVkLlxuICAgICAgICAvL1xuICAgICAgICAvLyBUaGlzIG1pZGRsZXdhcmUgc2ltcGx5IGluaXRpYWxpemVzIGEgbmV3IGF1dGhvcml6YXRpb24gdHJhbnNhY3Rpb24uICBJdCBpc1xuICAgICAgICAvLyB0aGUgYXBwbGljYXRpb24ncyByZXNwb25zaWJpbGl0eSB0byBhdXRoZW50aWNhdGUgdGhlIHVzZXIgYW5kIHJlbmRlciBhIGRpYWxvZ1xuICAgICAgICAvLyB0byBvYnRhaW4gdGhlaXIgYXBwcm92YWwgKGRpc3BsYXlpbmcgZGV0YWlscyBhYm91dCB0aGUgY2xpZW50IHJlcXVlc3RpbmdcbiAgICAgICAgLy8gYXV0aG9yaXphdGlvbikuICBXZSBhY2NvbXBsaXNoIHRoYXQgaGVyZSBieSByb3V0aW5nIHRocm91Z2ggYGVuc3VyZUxvZ2dlZEluKClgXG4gICAgICAgIC8vIGZpcnN0LCBhbmQgcmVuZGVyaW5nIHRoZSBgZGlhbG9nYCB2aWV3LiBcblxuICAgICAgICBhcHAucmVnaXN0ZXJNaWRkbGV3YXJlRmFjdG9yeSgnb2F1dGgyQXV0aG9yaXphdGlvbicsICgpID0+IFtcbiAgICAgICAgICAgIFwicGFzc3BvcnRDaGVja1wiLFxuICAgICAgICAgICAgIHNlcnZlci5hdXRob3JpemUoc3RyYXRlZ3kuYXV0aG9yaXplKVxuICAgICAgICBdKTsgICAgICAgIFxuXG4gICAgICAgIC8vIHVzZXIgZGVjaXNpb24gZW5kcG9pbnRcbiAgICAgICAgLy9cbiAgICAgICAgLy8gYGRlY2lzaW9uYCBtaWRkbGV3YXJlIHByb2Nlc3NlcyBhIHVzZXIncyBkZWNpc2lvbiB0byBhbGxvdyBvciBkZW55IGFjY2Vzc1xuICAgICAgICAvLyByZXF1ZXN0ZWQgYnkgYSBjbGllbnQgYXBwbGljYXRpb24uICBCYXNlZCBvbiB0aGUgZ3JhbnQgdHlwZSByZXF1ZXN0ZWQgYnkgdGhlXG4gICAgICAgIC8vIGNsaWVudCwgdGhlIGFib3ZlIGdyYW50IG1pZGRsZXdhcmUgY29uZmlndXJlZCBhYm92ZSB3aWxsIGJlIGludm9rZWQgdG8gc2VuZFxuICAgICAgICAvLyBhIHJlc3BvbnNlLlxuXG4gICAgICAgIGFwcC5yZWdpc3Rlck1pZGRsZXdhcmVGYWN0b3J5KCdvYXV0aDJEZWNpc2lvbicsICgpID0+IFtcbiAgICAgICAgICAgIFwicGFzc3BvcnRDaGVja1wiLFxuICAgICAgICAgICAgIHNlcnZlci5kZWNpc2lvbigpXG4gICAgICAgIF0pOyAgICAgICAgXG5cbiAgICAgICAgLy8gdG9rZW4gZW5kcG9pbnRcbiAgICAgICAgLy9cbiAgICAgICAgLy8gYHRva2VuYCBtaWRkbGV3YXJlIGhhbmRsZXMgY2xpZW50IHJlcXVlc3RzIHRvIGV4Y2hhbmdlIGF1dGhvcml6YXRpb24gZ3JhbnRzXG4gICAgICAgIC8vIGZvciBhY2Nlc3MgdG9rZW5zLiAgQmFzZWQgb24gdGhlIGdyYW50IHR5cGUgYmVpbmcgZXhjaGFuZ2VkLCB0aGUgYWJvdmVcbiAgICAgICAgLy8gZXhjaGFuZ2UgbWlkZGxld2FyZSB3aWxsIGJlIGludm9rZWQgdG8gaGFuZGxlIHRoZSByZXF1ZXN0LiAgQ2xpZW50cyBtdXN0XG4gICAgICAgIC8vIGF1dGhlbnRpY2F0ZSB3aGVuIG1ha2luZyByZXF1ZXN0cyB0byB0aGlzIGVuZHBvaW50LlxuXG4gICAgICAgIGFwcC5yZWdpc3Rlck1pZGRsZXdhcmVGYWN0b3J5KCdvYXV0aDJUb2tlbicsICgpID0+IFtcbiAgICAgICAgICAgIFsgXG4gICAgICAgICAgICAgICAgXCJwYXNzcG9ydEF1dGhcIiwgeyBcbiAgICAgICAgICAgICAgICAgICAgXCJzdHJhdGVneVwiOiBbJ2Jhc2ljJywgJ29hdXRoMi1jbGllbnQtcGFzc3dvcmQnXSwgXG4gICAgICAgICAgICAgICAgICAgIFwib3B0aW9uc1wiOiAgeyBzZXNzaW9uOiBmYWxzZSB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIHNlcnZlci50b2tlbigpLFxuICAgICAgICAgICAgc2VydmVyLmVycm9ySGFuZGxlcigpXG4gICAgICAgIF0pOyAgIFxuICAgIH1cbn07Il19