"use strict";

require("source-map-support/register");

const path = require('path');

const {
  Feature
} = require('..').enum;

const {
  tryRequire,
  dependsOn
} = require('@genx/app/lib/utils/Helpers');

module.exports = {
  type: Feature.PLUGIN,
  load_: function (app, config) {
    dependsOn('passport', app, 'oauth2');
    const oauth2orize = tryRequire('oauth2orize-koa');
    const server = oauth2orize.createServer();
    let strategy, strategyScript;

    try {
      strategyScript = path.join(app.backendPath, 'oauth2', 'strategy.js');

      let strategyInitiator = require(strategyScript);

      strategy = strategyInitiator(app, server);

      if (!strategy) {
        throw new Error(`Invalid oauth2 strategy.`);
      }
    } catch (error) {
      if (error.code === 'MODULE_NOT_FOUND') {
        throw new Error(`oauth2 strategy file "${strategyScript}" not found.`);
      }

      throw error;
    }

    server.serializeClient(strategy.serializeClient);
    server.deserializeClient(strategy.deserializeClient);
    server.grant(oauth2orize.grant.code(strategy.grantCode));
    server.exchange(oauth2orize.exchange.code(strategy.exchangeCode));
    app.registerMiddlewareFactory('oauth2Authorization', () => ["passportCheck", server.authorize(strategy.authorize)]);
    app.registerMiddlewareFactory('oauth2Decision', () => ["passportCheck", server.decision()]);
    app.registerMiddlewareFactory('oauth2Token', () => [["passportAuth", {
      "strategy": ['basic', 'oauth2-client-password'],
      "options": {
        session: false
      }
    }], server.token(), server.errorHandler()]);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9vYXV0aDIuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJGZWF0dXJlIiwiZW51bSIsInRyeVJlcXVpcmUiLCJkZXBlbmRzT24iLCJtb2R1bGUiLCJleHBvcnRzIiwidHlwZSIsIlBMVUdJTiIsImxvYWRfIiwiYXBwIiwiY29uZmlnIiwib2F1dGgyb3JpemUiLCJzZXJ2ZXIiLCJjcmVhdGVTZXJ2ZXIiLCJzdHJhdGVneSIsInN0cmF0ZWd5U2NyaXB0Iiwiam9pbiIsImJhY2tlbmRQYXRoIiwic3RyYXRlZ3lJbml0aWF0b3IiLCJFcnJvciIsImVycm9yIiwiY29kZSIsInNlcmlhbGl6ZUNsaWVudCIsImRlc2VyaWFsaXplQ2xpZW50IiwiZ3JhbnQiLCJncmFudENvZGUiLCJleGNoYW5nZSIsImV4Y2hhbmdlQ29kZSIsInJlZ2lzdGVyTWlkZGxld2FyZUZhY3RvcnkiLCJhdXRob3JpemUiLCJkZWNpc2lvbiIsInNlc3Npb24iLCJ0b2tlbiIsImVycm9ySGFuZGxlciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFPQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU07QUFBRUMsRUFBQUE7QUFBRixJQUFjRCxPQUFPLENBQUMsSUFBRCxDQUFQLENBQWNFLElBQWxDOztBQUNBLE1BQU07QUFBRUMsRUFBQUEsVUFBRjtBQUFjQyxFQUFBQTtBQUFkLElBQTRCSixPQUFPLENBQUMsNkJBQUQsQ0FBekM7O0FBRUFLLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQU1iQyxFQUFBQSxJQUFJLEVBQUVOLE9BQU8sQ0FBQ08sTUFORDtBQWNiQyxFQUFBQSxLQUFLLEVBQUUsVUFBVUMsR0FBVixFQUFlQyxNQUFmLEVBQXVCO0FBQzFCUCxJQUFBQSxTQUFTLENBQUMsVUFBRCxFQUFhTSxHQUFiLEVBQWtCLFFBQWxCLENBQVQ7QUFlQSxVQUFNRSxXQUFXLEdBQUdULFVBQVUsQ0FBQyxpQkFBRCxDQUE5QjtBQUdBLFVBQU1VLE1BQU0sR0FBR0QsV0FBVyxDQUFDRSxZQUFaLEVBQWY7QUFFQSxRQUFJQyxRQUFKLEVBQWNDLGNBQWQ7O0FBRUEsUUFBSTtBQUNBQSxNQUFBQSxjQUFjLEdBQUdqQixJQUFJLENBQUNrQixJQUFMLENBQVVQLEdBQUcsQ0FBQ1EsV0FBZCxFQUEyQixRQUEzQixFQUFxQyxhQUFyQyxDQUFqQjs7QUFDQSxVQUFJQyxpQkFBaUIsR0FBR25CLE9BQU8sQ0FBQ2dCLGNBQUQsQ0FBL0I7O0FBQ0FELE1BQUFBLFFBQVEsR0FBR0ksaUJBQWlCLENBQUNULEdBQUQsRUFBTUcsTUFBTixDQUE1Qjs7QUFFQSxVQUFJLENBQUNFLFFBQUwsRUFBZTtBQUNYLGNBQU0sSUFBSUssS0FBSixDQUFXLDBCQUFYLENBQU47QUFDSDtBQUNKLEtBUkQsQ0FRRSxPQUFPQyxLQUFQLEVBQWM7QUFDWixVQUFJQSxLQUFLLENBQUNDLElBQU4sS0FBZSxrQkFBbkIsRUFBdUM7QUFDbkMsY0FBTSxJQUFJRixLQUFKLENBQVcseUJBQXdCSixjQUFlLGNBQWxELENBQU47QUFDSDs7QUFFRCxZQUFNSyxLQUFOO0FBQ0g7O0FBZURSLElBQUFBLE1BQU0sQ0FBQ1UsZUFBUCxDQUF1QlIsUUFBUSxDQUFDUSxlQUFoQztBQUVBVixJQUFBQSxNQUFNLENBQUNXLGlCQUFQLENBQXlCVCxRQUFRLENBQUNTLGlCQUFsQztBQWdCQVgsSUFBQUEsTUFBTSxDQUFDWSxLQUFQLENBQWFiLFdBQVcsQ0FBQ2EsS0FBWixDQUFrQkgsSUFBbEIsQ0FBdUJQLFFBQVEsQ0FBQ1csU0FBaEMsQ0FBYjtBQVFBYixJQUFBQSxNQUFNLENBQUNjLFFBQVAsQ0FBZ0JmLFdBQVcsQ0FBQ2UsUUFBWixDQUFxQkwsSUFBckIsQ0FBMEJQLFFBQVEsQ0FBQ2EsWUFBbkMsQ0FBaEI7QUFrQkFsQixJQUFBQSxHQUFHLENBQUNtQix5QkFBSixDQUE4QixxQkFBOUIsRUFBcUQsTUFBTSxDQUN2RCxlQUR1RCxFQUV0RGhCLE1BQU0sQ0FBQ2lCLFNBQVAsQ0FBaUJmLFFBQVEsQ0FBQ2UsU0FBMUIsQ0FGc0QsQ0FBM0Q7QUFZQXBCLElBQUFBLEdBQUcsQ0FBQ21CLHlCQUFKLENBQThCLGdCQUE5QixFQUFnRCxNQUFNLENBQ2xELGVBRGtELEVBRWpEaEIsTUFBTSxDQUFDa0IsUUFBUCxFQUZpRCxDQUF0RDtBQVlBckIsSUFBQUEsR0FBRyxDQUFDbUIseUJBQUosQ0FBOEIsYUFBOUIsRUFBNkMsTUFBTSxDQUMvQyxDQUNJLGNBREosRUFDb0I7QUFDWixrQkFBWSxDQUFDLE9BQUQsRUFBVSx3QkFBVixDQURBO0FBRVosaUJBQVk7QUFBRUcsUUFBQUEsT0FBTyxFQUFFO0FBQVg7QUFGQSxLQURwQixDQUQrQyxFQU8vQ25CLE1BQU0sQ0FBQ29CLEtBQVAsRUFQK0MsRUFRL0NwQixNQUFNLENBQUNxQixZQUFQLEVBUitDLENBQW5EO0FBVUg7QUFoSlksQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBFbmFibGUgb2F1dGgyIGZlYXR1cmVcbiAqIEBtb2R1bGUgRmVhdHVyZV9PQXV0aDJcbiAqL1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgeyBGZWF0dXJlIH0gPSByZXF1aXJlKCcuLicpLmVudW07XG5jb25zdCB7IHRyeVJlcXVpcmUsIGRlcGVuZHNPbiB9ID0gcmVxdWlyZSgnQGdlbngvYXBwL2xpYi91dGlscy9IZWxwZXJzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBmZWF0dXJlIGlzIGxvYWRlZCBhdCBzZXJ2aWNlIHN0YWdlXG4gICAgICogQG1lbWJlciB7c3RyaW5nfVxuICAgICAqL1xuICAgIHR5cGU6IEZlYXR1cmUuUExVR0lOLFxuXG4gICAgLyoqXG4gICAgICogTG9hZCB0aGUgZmVhdHVyZVxuICAgICAqIEBwYXJhbSB7Um91dGFibGV9IGFwcCAtIFRoZSBhcHAgbW9kdWxlIG9iamVjdFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBjb25maWcgLSBQYXNzcG9ydCBjb25maWdcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48Kj59XG4gICAgICovXG4gICAgbG9hZF86IGZ1bmN0aW9uIChhcHAsIGNvbmZpZykge1xuICAgICAgICBkZXBlbmRzT24oJ3Bhc3Nwb3J0JywgYXBwLCAnb2F1dGgyJyk7XG5cbiAgICAgICAgLypcbiAgICAgICAgbGV0IHBhc3Nwb3J0ID0gYXBwLmdldFNlcnZpY2UoJ3Bhc3Nwb3J0Jyk7XG4gICAgICAgIGlmICghcGFzc3BvcnQuaGFzU3RyYXRlZ3koJ2Jhc2ljJykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignb2F1dGgyIHJlcXVpcmVzIFwiYmFzaWNcIiBwYXNzcG9ydCBzdHJhdGVneS4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghcGFzc3BvcnQuaGFzU3RyYXRlZ3koJ29hdXRoMi1jbGllbnQtcGFzc3dvcmQnKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdvYXV0aDIgcmVxdWlyZXMgXCJvYXV0aDItY2xpZW50LXBhc3N3b3JkXCIgcGFzc3BvcnQgc3RyYXRlZ3kuJyk7XG4gICAgICAgIH0qL1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNb2R1bGUgZGVwZW5kZW5jaWVzLlxuICAgICAgICAgKi8gICAgICAgIFxuICAgICAgICBjb25zdCBvYXV0aDJvcml6ZSA9IHRyeVJlcXVpcmUoJ29hdXRoMm9yaXplLWtvYScpOyAgICAgICAgXG5cbiAgICAgICAgLy8gY3JlYXRlIE9BdXRoIDIuMCBzZXJ2ZXJcbiAgICAgICAgY29uc3Qgc2VydmVyID0gb2F1dGgyb3JpemUuY3JlYXRlU2VydmVyKCk7ICAgICAgICBcblxuICAgICAgICBsZXQgc3RyYXRlZ3ksIHN0cmF0ZWd5U2NyaXB0O1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzdHJhdGVneVNjcmlwdCA9IHBhdGguam9pbihhcHAuYmFja2VuZFBhdGgsICdvYXV0aDInLCAnc3RyYXRlZ3kuanMnKTtcbiAgICAgICAgICAgIGxldCBzdHJhdGVneUluaXRpYXRvciA9IHJlcXVpcmUoc3RyYXRlZ3lTY3JpcHQpO1xuICAgICAgICAgICAgc3RyYXRlZ3kgPSBzdHJhdGVneUluaXRpYXRvcihhcHAsIHNlcnZlcik7XG5cbiAgICAgICAgICAgIGlmICghc3RyYXRlZ3kpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgb2F1dGgyIHN0cmF0ZWd5LmApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdNT0RVTEVfTk9UX0ZPVU5EJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgb2F1dGgyIHN0cmF0ZWd5IGZpbGUgXCIke3N0cmF0ZWd5U2NyaXB0fVwiIG5vdCBmb3VuZC5gKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlZ2lzdGVyIHNlcmlhbGlhbGl6YXRpb24gYW5kIGRlc2VyaWFsaXphdGlvbiBmdW5jdGlvbnMuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFdoZW4gYSBjbGllbnQgcmVkaXJlY3RzIGEgdXNlciB0byB1c2VyIGF1dGhvcml6YXRpb24gZW5kcG9pbnQsIGFuXG4gICAgICAgIC8vIGF1dGhvcml6YXRpb24gdHJhbnNhY3Rpb24gaXMgaW5pdGlhdGVkLiAgVG8gY29tcGxldGUgdGhlIHRyYW5zYWN0aW9uLCB0aGVcbiAgICAgICAgLy8gdXNlciBtdXN0IGF1dGhlbnRpY2F0ZSBhbmQgYXBwcm92ZSB0aGUgYXV0aG9yaXphdGlvbiByZXF1ZXN0LiAgQmVjYXVzZSB0aGlzXG4gICAgICAgIC8vIG1heSBpbnZvbHZlIG11bHRpcGxlIEhUVFAgcmVxdWVzdC9yZXNwb25zZSBleGNoYW5nZXMsIHRoZSB0cmFuc2FjdGlvbiBpc1xuICAgICAgICAvLyBzdG9yZWQgaW4gdGhlIHNlc3Npb24uXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEFuIGFwcGxpY2F0aW9uIG11c3Qgc3VwcGx5IHNlcmlhbGl6YXRpb24gZnVuY3Rpb25zLCB3aGljaCBkZXRlcm1pbmUgaG93IHRoZVxuICAgICAgICAvLyBjbGllbnQgb2JqZWN0IGlzIHNlcmlhbGl6ZWQgaW50byB0aGUgc2Vzc2lvbi4gIFR5cGljYWxseSB0aGlzIHdpbGwgYmUgYVxuICAgICAgICAvLyBzaW1wbGUgbWF0dGVyIG9mIHNlcmlhbGl6aW5nIHRoZSBjbGllbnQncyBJRCwgYW5kIGRlc2VyaWFsaXppbmcgYnkgZmluZGluZ1xuICAgICAgICAvLyB0aGUgY2xpZW50IGJ5IElEIGZyb20gdGhlIGRhdGFiYXNlLlxuXG4gICAgICAgIHNlcnZlci5zZXJpYWxpemVDbGllbnQoc3RyYXRlZ3kuc2VyaWFsaXplQ2xpZW50KTtcblxuICAgICAgICBzZXJ2ZXIuZGVzZXJpYWxpemVDbGllbnQoc3RyYXRlZ3kuZGVzZXJpYWxpemVDbGllbnQpO1xuXG4gICAgICAgIC8vIFJlZ2lzdGVyIHN1cHBvcnRlZCBncmFudCB0eXBlcy5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gT0F1dGggMi4wIHNwZWNpZmllcyBhIGZyYW1ld29yayB0aGF0IGFsbG93cyB1c2VycyB0byBncmFudCBjbGllbnRcbiAgICAgICAgLy8gYXBwbGljYXRpb25zIGxpbWl0ZWQgYWNjZXNzIHRvIHRoZWlyIHByb3RlY3RlZCByZXNvdXJjZXMuICBJdCBkb2VzIHRoaXNcbiAgICAgICAgLy8gdGhyb3VnaCBhIHByb2Nlc3Mgb2YgdGhlIHVzZXIgZ3JhbnRpbmcgYWNjZXNzLCBhbmQgdGhlIGNsaWVudCBleGNoYW5naW5nXG4gICAgICAgIC8vIHRoZSBncmFudCBmb3IgYW4gYWNjZXNzIHRva2VuLlxuXG4gICAgICAgIC8vIEdyYW50IGF1dGhvcml6YXRpb24gY29kZXMuICBUaGUgY2FsbGJhY2sgdGFrZXMgdGhlIGBjbGllbnRgIHJlcXVlc3RpbmdcbiAgICAgICAgLy8gYXV0aG9yaXphdGlvbiwgdGhlIGByZWRpcmVjdFVSSWAgKHdoaWNoIGlzIHVzZWQgYXMgYSB2ZXJpZmllciBpbiB0aGVcbiAgICAgICAgLy8gc3Vic2VxdWVudCBleGNoYW5nZSksIHRoZSBhdXRoZW50aWNhdGVkIGB1c2VyYCBncmFudGluZyBhY2Nlc3MsIGFuZFxuICAgICAgICAvLyB0aGVpciByZXNwb25zZSwgd2hpY2ggY29udGFpbnMgYXBwcm92ZWQgc2NvcGUsIGR1cmF0aW9uLCBldGMuIGFzIHBhcnNlZCBieVxuICAgICAgICAvLyB0aGUgYXBwbGljYXRpb24uICBUaGUgYXBwbGljYXRpb24gaXNzdWVzIGEgY29kZSwgd2hpY2ggaXMgYm91bmQgdG8gdGhlc2VcbiAgICAgICAgLy8gdmFsdWVzLCBhbmQgd2lsbCBiZSBleGNoYW5nZWQgZm9yIGFuIGFjY2VzcyB0b2tlbi5cblxuICAgICAgICBzZXJ2ZXIuZ3JhbnQob2F1dGgyb3JpemUuZ3JhbnQuY29kZShzdHJhdGVneS5ncmFudENvZGUpKTtcblxuICAgICAgICAvLyBFeGNoYW5nZSBhdXRob3JpemF0aW9uIGNvZGVzIGZvciBhY2Nlc3MgdG9rZW5zLiAgVGhlIGNhbGxiYWNrIGFjY2VwdHMgdGhlXG4gICAgICAgIC8vIGBjbGllbnRgLCB3aGljaCBpcyBleGNoYW5naW5nIGBjb2RlYCBhbmQgYW55IGByZWRpcmVjdFVSSWAgZnJvbSB0aGVcbiAgICAgICAgLy8gYXV0aG9yaXphdGlvbiByZXF1ZXN0IGZvciB2ZXJpZmljYXRpb24uICBJZiB0aGVzZSB2YWx1ZXMgYXJlIHZhbGlkYXRlZCwgdGhlXG4gICAgICAgIC8vIGFwcGxpY2F0aW9uIGlzc3VlcyBhbiBhY2Nlc3MgdG9rZW4gb24gYmVoYWxmIG9mIHRoZSB1c2VyIHdobyBhdXRob3JpemVkIHRoZVxuICAgICAgICAvLyBjb2RlLlxuXG4gICAgICAgIHNlcnZlci5leGNoYW5nZShvYXV0aDJvcml6ZS5leGNoYW5nZS5jb2RlKHN0cmF0ZWd5LmV4Y2hhbmdlQ29kZSkpO1xuXG4gICAgICAgIC8vIHVzZXIgYXV0aG9yaXphdGlvbiBlbmRwb2ludFxuICAgICAgICAvL1xuICAgICAgICAvLyBgYXV0aG9yaXphdGlvbmAgbWlkZGxld2FyZSBhY2NlcHRzIGEgYHZhbGlkYXRlYCBjYWxsYmFjayB3aGljaCBpc1xuICAgICAgICAvLyByZXNwb25zaWJsZSBmb3IgdmFsaWRhdGluZyB0aGUgY2xpZW50IG1ha2luZyB0aGUgYXV0aG9yaXphdGlvbiByZXF1ZXN0LiAgSW5cbiAgICAgICAgLy8gZG9pbmcgc28sIGlzIHJlY29tbWVuZGVkIHRoYXQgdGhlIGByZWRpcmVjdFVSSWAgYmUgY2hlY2tlZCBhZ2FpbnN0IGFcbiAgICAgICAgLy8gcmVnaXN0ZXJlZCB2YWx1ZSwgYWx0aG91Z2ggc2VjdXJpdHkgcmVxdWlyZW1lbnRzIG1heSB2YXJ5IGFjY3Jvc3NcbiAgICAgICAgLy8gaW1wbGVtZW50YXRpb25zLiAgT25jZSB2YWxpZGF0ZWQsIHRoZSBgZG9uZWAgY2FsbGJhY2sgbXVzdCBiZSBpbnZva2VkIHdpdGhcbiAgICAgICAgLy8gYSBgY2xpZW50YCBpbnN0YW5jZSwgYXMgd2VsbCBhcyB0aGUgYHJlZGlyZWN0VVJJYCB0byB3aGljaCB0aGUgdXNlciB3aWxsIGJlXG4gICAgICAgIC8vIHJlZGlyZWN0ZWQgYWZ0ZXIgYW4gYXV0aG9yaXphdGlvbiBkZWNpc2lvbiBpcyBvYnRhaW5lZC5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gVGhpcyBtaWRkbGV3YXJlIHNpbXBseSBpbml0aWFsaXplcyBhIG5ldyBhdXRob3JpemF0aW9uIHRyYW5zYWN0aW9uLiAgSXQgaXNcbiAgICAgICAgLy8gdGhlIGFwcGxpY2F0aW9uJ3MgcmVzcG9uc2liaWxpdHkgdG8gYXV0aGVudGljYXRlIHRoZSB1c2VyIGFuZCByZW5kZXIgYSBkaWFsb2dcbiAgICAgICAgLy8gdG8gb2J0YWluIHRoZWlyIGFwcHJvdmFsIChkaXNwbGF5aW5nIGRldGFpbHMgYWJvdXQgdGhlIGNsaWVudCByZXF1ZXN0aW5nXG4gICAgICAgIC8vIGF1dGhvcml6YXRpb24pLiAgV2UgYWNjb21wbGlzaCB0aGF0IGhlcmUgYnkgcm91dGluZyB0aHJvdWdoIGBlbnN1cmVMb2dnZWRJbigpYFxuICAgICAgICAvLyBmaXJzdCwgYW5kIHJlbmRlcmluZyB0aGUgYGRpYWxvZ2Agdmlldy4gXG5cbiAgICAgICAgYXBwLnJlZ2lzdGVyTWlkZGxld2FyZUZhY3RvcnkoJ29hdXRoMkF1dGhvcml6YXRpb24nLCAoKSA9PiBbXG4gICAgICAgICAgICBcInBhc3Nwb3J0Q2hlY2tcIixcbiAgICAgICAgICAgICBzZXJ2ZXIuYXV0aG9yaXplKHN0cmF0ZWd5LmF1dGhvcml6ZSlcbiAgICAgICAgXSk7ICAgICAgICBcblxuICAgICAgICAvLyB1c2VyIGRlY2lzaW9uIGVuZHBvaW50XG4gICAgICAgIC8vXG4gICAgICAgIC8vIGBkZWNpc2lvbmAgbWlkZGxld2FyZSBwcm9jZXNzZXMgYSB1c2VyJ3MgZGVjaXNpb24gdG8gYWxsb3cgb3IgZGVueSBhY2Nlc3NcbiAgICAgICAgLy8gcmVxdWVzdGVkIGJ5IGEgY2xpZW50IGFwcGxpY2F0aW9uLiAgQmFzZWQgb24gdGhlIGdyYW50IHR5cGUgcmVxdWVzdGVkIGJ5IHRoZVxuICAgICAgICAvLyBjbGllbnQsIHRoZSBhYm92ZSBncmFudCBtaWRkbGV3YXJlIGNvbmZpZ3VyZWQgYWJvdmUgd2lsbCBiZSBpbnZva2VkIHRvIHNlbmRcbiAgICAgICAgLy8gYSByZXNwb25zZS5cblxuICAgICAgICBhcHAucmVnaXN0ZXJNaWRkbGV3YXJlRmFjdG9yeSgnb2F1dGgyRGVjaXNpb24nLCAoKSA9PiBbXG4gICAgICAgICAgICBcInBhc3Nwb3J0Q2hlY2tcIixcbiAgICAgICAgICAgICBzZXJ2ZXIuZGVjaXNpb24oKVxuICAgICAgICBdKTsgICAgICAgIFxuXG4gICAgICAgIC8vIHRva2VuIGVuZHBvaW50XG4gICAgICAgIC8vXG4gICAgICAgIC8vIGB0b2tlbmAgbWlkZGxld2FyZSBoYW5kbGVzIGNsaWVudCByZXF1ZXN0cyB0byBleGNoYW5nZSBhdXRob3JpemF0aW9uIGdyYW50c1xuICAgICAgICAvLyBmb3IgYWNjZXNzIHRva2Vucy4gIEJhc2VkIG9uIHRoZSBncmFudCB0eXBlIGJlaW5nIGV4Y2hhbmdlZCwgdGhlIGFib3ZlXG4gICAgICAgIC8vIGV4Y2hhbmdlIG1pZGRsZXdhcmUgd2lsbCBiZSBpbnZva2VkIHRvIGhhbmRsZSB0aGUgcmVxdWVzdC4gIENsaWVudHMgbXVzdFxuICAgICAgICAvLyBhdXRoZW50aWNhdGUgd2hlbiBtYWtpbmcgcmVxdWVzdHMgdG8gdGhpcyBlbmRwb2ludC5cblxuICAgICAgICBhcHAucmVnaXN0ZXJNaWRkbGV3YXJlRmFjdG9yeSgnb2F1dGgyVG9rZW4nLCAoKSA9PiBbXG4gICAgICAgICAgICBbIFxuICAgICAgICAgICAgICAgIFwicGFzc3BvcnRBdXRoXCIsIHsgXG4gICAgICAgICAgICAgICAgICAgIFwic3RyYXRlZ3lcIjogWydiYXNpYycsICdvYXV0aDItY2xpZW50LXBhc3N3b3JkJ10sIFxuICAgICAgICAgICAgICAgICAgICBcIm9wdGlvbnNcIjogIHsgc2Vzc2lvbjogZmFsc2UgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBzZXJ2ZXIudG9rZW4oKSxcbiAgICAgICAgICAgIHNlcnZlci5lcnJvckhhbmRsZXIoKVxuICAgICAgICBdKTsgICBcbiAgICB9XG59OyJdfQ==