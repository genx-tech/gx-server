{"version":3,"file":"httpMethod.js","names":["_","require","httpMethod","method","middlewares","arguments","length","Array","prototype","slice","call","target","name","descriptor","targetFunction","isHof","kind","value","enumerable","Error","pos","indexOf","__metaRoute","substr","toLocaleLowerCase","__metaHttpMethod","isPlainObject","__metaMiddlewares","map","options","castArray","module","exports"],"sources":["../../src/utils/httpMethod.js"],"sourcesContent":["const { _ } = require(\"@genx/july\");\n\nfunction httpMethod(method, middlewares) {\n    if (arguments.length === 3) {\n        return httpMethod(\"get\")(...Array.prototype.slice.call(arguments));\n    }\n\n    return function (target, name, descriptor) {\n        let targetFunction,\n            isHof = false;\n\n        if (arguments.length === 1 && typeof target === \"function\") {\n            targetFunction = target;\n            isHof = true;\n        } else if (arguments.length === 1 && target.kind === \"method\") {\n            targetFunction = target.descriptor.value;\n            target.descriptor.enumerable = true;\n        } else if (descriptor && descriptor.value) {\n            targetFunction = descriptor.value;\n            descriptor.enumerable = true;\n        } else {\n            throw new Error(\"Unsupported scenario.\");\n        }\n\n        if (targetFunction) {\n            if (typeof method === \"string\") {\n                let pos = method.indexOf(\":/\");\n\n                if (pos !== -1) {\n                    if (pos === 0) {\n                        throw new Error(\"Invalid httpMethod decorator param: \" + method);\n                    }\n\n                    // like get:/, or post:/\n\n                    //override actionName as route\n                    targetFunction.__metaRoute = method.substr(pos + 1);\n                    method = method.substr(0, pos).toLocaleLowerCase();\n                }\n            } else {\n                method = \"get\";\n            }\n\n            targetFunction.__metaHttpMethod = method;\n\n            if (middlewares) {\n                if (_.isPlainObject(middlewares)) {\n                    targetFunction.__metaMiddlewares = _.map(middlewares, (options, name) => ({ name, options }));\n                } else {\n                    targetFunction.__metaMiddlewares = _.castArray(middlewares);\n                }\n            }\n        }\n\n        return isHof ? targetFunction : descriptor;\n    };\n}\n\nmodule.exports = httpMethod;\n"],"mappings":";;;;AAAA,MAAM;EAAEA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AAEA,SAASC,UAAT,CAAoBC,MAApB,EAA4BC,WAA5B,EAAyC;EACrC,IAAIC,SAAS,CAACC,MAAV,KAAqB,CAAzB,EAA4B;IACxB,OAAOJ,UAAU,CAAC,KAAD,CAAV,CAAkB,GAAGK,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BL,SAA3B,CAArB,CAAP;EACH;;EAED,OAAO,UAAUM,MAAV,EAAkBC,IAAlB,EAAwBC,UAAxB,EAAoC;IACvC,IAAIC,cAAJ;IAAA,IACIC,KAAK,GAAG,KADZ;;IAGA,IAAIV,SAAS,CAACC,MAAV,KAAqB,CAArB,IAA0B,OAAOK,MAAP,KAAkB,UAAhD,EAA4D;MACxDG,cAAc,GAAGH,MAAjB;MACAI,KAAK,GAAG,IAAR;IACH,CAHD,MAGO,IAAIV,SAAS,CAACC,MAAV,KAAqB,CAArB,IAA0BK,MAAM,CAACK,IAAP,KAAgB,QAA9C,EAAwD;MAC3DF,cAAc,GAAGH,MAAM,CAACE,UAAP,CAAkBI,KAAnC;MACAN,MAAM,CAACE,UAAP,CAAkBK,UAAlB,GAA+B,IAA/B;IACH,CAHM,MAGA,IAAIL,UAAU,IAAIA,UAAU,CAACI,KAA7B,EAAoC;MACvCH,cAAc,GAAGD,UAAU,CAACI,KAA5B;MACAJ,UAAU,CAACK,UAAX,GAAwB,IAAxB;IACH,CAHM,MAGA;MACH,MAAM,IAAIC,KAAJ,CAAU,uBAAV,CAAN;IACH;;IAED,IAAIL,cAAJ,EAAoB;MAChB,IAAI,OAAOX,MAAP,KAAkB,QAAtB,EAAgC;QAC5B,IAAIiB,GAAG,GAAGjB,MAAM,CAACkB,OAAP,CAAe,IAAf,CAAV;;QAEA,IAAID,GAAG,KAAK,CAAC,CAAb,EAAgB;UACZ,IAAIA,GAAG,KAAK,CAAZ,EAAe;YACX,MAAM,IAAID,KAAJ,CAAU,yCAAyChB,MAAnD,CAAN;UACH;;UAKDW,cAAc,CAACQ,WAAf,GAA6BnB,MAAM,CAACoB,MAAP,CAAcH,GAAG,GAAG,CAApB,CAA7B;UACAjB,MAAM,GAAGA,MAAM,CAACoB,MAAP,CAAc,CAAd,EAAiBH,GAAjB,EAAsBI,iBAAtB,EAAT;QACH;MACJ,CAdD,MAcO;QACHrB,MAAM,GAAG,KAAT;MACH;;MAEDW,cAAc,CAACW,gBAAf,GAAkCtB,MAAlC;;MAEA,IAAIC,WAAJ,EAAiB;QACb,IAAIJ,CAAC,CAAC0B,aAAF,CAAgBtB,WAAhB,CAAJ,EAAkC;UAC9BU,cAAc,CAACa,iBAAf,GAAmC3B,CAAC,CAAC4B,GAAF,CAAMxB,WAAN,EAAmB,CAACyB,OAAD,EAAUjB,IAAV,MAAoB;YAAEA,IAAF;YAAQiB;UAAR,CAApB,CAAnB,CAAnC;QACH,CAFD,MAEO;UACHf,cAAc,CAACa,iBAAf,GAAmC3B,CAAC,CAAC8B,SAAF,CAAY1B,WAAZ,CAAnC;QACH;MACJ;IACJ;;IAED,OAAOW,KAAK,GAAGD,cAAH,GAAoBD,UAAhC;EACH,CAhDD;AAiDH;;AAEDkB,MAAM,CAACC,OAAP,GAAiB9B,UAAjB"}