"use strict";

require("source-map-support/register");

const HttpCode = require('http-status-codes');

module.exports = (options, app) => {
  return async (ctx, next) => {
    if (ctx.isAuthenticated()) {
      return next();
    }

    if (options.successReturnToOrRedirect && ctx.session) {
      ctx.session.returnTo = ctx.originalUrl || ctx.url;
    }

    if (!options.loginUrl) {
      ctx.throw(HttpCode.UNAUTHORIZED, 'authentication required');
    }

    return ctx.redirect(options.loginUrl);
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlcy9wYXNzcG9ydENoZWNrLmpzIl0sIm5hbWVzIjpbIkh0dHBDb2RlIiwicmVxdWlyZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJvcHRpb25zIiwiYXBwIiwiY3R4IiwibmV4dCIsImlzQXV0aGVudGljYXRlZCIsInN1Y2Nlc3NSZXR1cm5Ub09yUmVkaXJlY3QiLCJzZXNzaW9uIiwicmV0dXJuVG8iLCJvcmlnaW5hbFVybCIsInVybCIsImxvZ2luVXJsIiwidGhyb3ciLCJVTkFVVEhPUklaRUQiLCJyZWRpcmVjdCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFPQSxNQUFNQSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxtQkFBRCxDQUF4Qjs7QUFTQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCLENBQUNDLE9BQUQsRUFBVUMsR0FBVixLQUFrQjtBQUMvQixTQUFPLE9BQU9DLEdBQVAsRUFBWUMsSUFBWixLQUFxQjtBQUN4QixRQUFJRCxHQUFHLENBQUNFLGVBQUosRUFBSixFQUEyQjtBQUN2QixhQUFPRCxJQUFJLEVBQVg7QUFDSDs7QUFFRCxRQUFJSCxPQUFPLENBQUNLLHlCQUFSLElBQXFDSCxHQUFHLENBQUNJLE9BQTdDLEVBQXNEO0FBQ2xESixNQUFBQSxHQUFHLENBQUNJLE9BQUosQ0FBWUMsUUFBWixHQUF1QkwsR0FBRyxDQUFDTSxXQUFKLElBQW1CTixHQUFHLENBQUNPLEdBQTlDO0FBQ0g7O0FBRUQsUUFBSSxDQUFDVCxPQUFPLENBQUNVLFFBQWIsRUFBdUI7QUFDbkJSLE1BQUFBLEdBQUcsQ0FBQ1MsS0FBSixDQUFVZixRQUFRLENBQUNnQixZQUFuQixFQUFpQyx5QkFBakM7QUFDSDs7QUFFRCxXQUFPVixHQUFHLENBQUNXLFFBQUosQ0FBYWIsT0FBTyxDQUFDVSxRQUFyQixDQUFQO0FBQ0gsR0FkRDtBQWVILENBaEJEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogTWlkZGxld2FyZSB0byBjaGVjayB1c2VyIGxvZ2dlZCBpbiBzdGF0dXMgYmFzZWQgb24gcGFzc3BvcnRcbiAqIEBtb2R1bGUgTWlkZGxld2FyZV9QYXNzcG9ydENoZWNrXG4gKi9cblxuY29uc3QgSHR0cENvZGUgPSByZXF1aXJlKCdodHRwLXN0YXR1cy1jb2RlcycpO1xuXG4vKipcbiAqIEluaXRpYWxpemUgZW5zdXJlTG9nZ2VkSW4gbWlkZGxld2FyZVxuICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbb3B0aW9ucy5sb2dpblVybF0gLSBJZiBnaXZlbiwgd2lsbCByZWRpcmVjdCB0byBsb2dpblVybCBpZiBub3QgbG9nZ2VkSW5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW29wdGlvbnMuc3VjY2Vzc1JldHVyblRvT3JSZWRpcmVjdF0gLSBJZiBnaXZlbiwgd2lsbCByZWRpcmVjdCB0byBsb2dpblVybCBpZiBub3QgbG9nZ2VkSW4gXG4gKiBAcGFyYW0ge1JvdXRhYmxlfSBhcHBcbiAqLyAgXG5tb2R1bGUuZXhwb3J0cyA9IChvcHRpb25zLCBhcHApID0+IHtcbiAgICByZXR1cm4gYXN5bmMgKGN0eCwgbmV4dCkgPT4ge1xuICAgICAgICBpZiAoY3R4LmlzQXV0aGVudGljYXRlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuc3VjY2Vzc1JldHVyblRvT3JSZWRpcmVjdCAmJiBjdHguc2Vzc2lvbikge1xuICAgICAgICAgICAgY3R4LnNlc3Npb24ucmV0dXJuVG8gPSBjdHgub3JpZ2luYWxVcmwgfHwgY3R4LnVybDsgICAgICAgICAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghb3B0aW9ucy5sb2dpblVybCkge1xuICAgICAgICAgICAgY3R4LnRocm93KEh0dHBDb2RlLlVOQVVUSE9SSVpFRCwgJ2F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY3R4LnJlZGlyZWN0KG9wdGlvbnMubG9naW5VcmwpO1xuICAgIH1cbn07Il19