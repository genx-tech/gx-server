{"version":3,"file":"apiWrapper.js","names":["Feature","Helpers","ensureFeatureName","require","http","statusToError","unknownError","module","exports","type","SERVICE","groupable","load_","app","settings","name","service","wrapResult","ctx","result","others","status","wrapError","error","code","message","expose","STATUS_CODES","info","registerService"],"sources":["../../src/serverFeatures/apiWrapper.js"],"sourcesContent":["const { Feature, Helpers: { ensureFeatureName } } = require('@genx/app');\nconst http = require('http');\n\nconst statusToError = {\n    400: 'invalid_request',\n    401: 'unauthenticated',\n    403: 'permission_denied',\n    404: 'resource_not_found',\n};\n\nconst unknownError = 'unknown_error';\n\nmodule.exports = {\n\n    /**\n     * This feature is loaded at init stage\n     * @member {string}\n     */\n    type: Feature.SERVICE,\n\n    /**\n     * This feature can be grouped by serviceGroup\n     * @member {boolean}\n     */\n    groupable: true,\n\n    /**\n     * Load the feature\n     * @param {App} app - The cli app module object\n     * @param {object} settings - Settings of soal client   \n     * @returns {Promise.<*>}\n     */\n    load_: async function (app, settings, name) {\n        ensureFeatureName(name);\n\n        const service = {\n            wrapResult: (ctx, result = null, others) => {\n                return {\n                    status: 'success',\n                    ...others,\n                    result,\n                };\n            },\n        \n            wrapError: (ctx, error, others) => {\n                const code = error.code || statusToError[ctx.status] || unknownError;\n                                \n                return {\n                    status: 'error',\n                    ...others,                    \n                    error: {\n                        code,\n                        message: error.expose\n                            ? error.message\n                            : http.STATUS_CODES[ctx.status],\n                        ...(error.info ? { info: error.info }: null)\n                    },\n                };\n            },\n        };\n\n        app.registerService(name, service);\n    }\n};"],"mappings":";;;AAAA,MAAM;EAAEA,OAAO;EAAEC,OAAO,EAAE;IAAEC;EAAkB;AAAE,CAAC,GAAGC,OAAO,CAAC,WAAW,CAAC;AACxE,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;AAE5B,MAAME,aAAa,GAAG;EAClB,GAAG,EAAE,iBAAiB;EACtB,GAAG,EAAE,iBAAiB;EACtB,GAAG,EAAE,mBAAmB;EACxB,GAAG,EAAE;AACT,CAAC;AAED,MAAMC,YAAY,GAAG,eAAe;AAEpCC,MAAM,CAACC,OAAO,GAAG;EAMbC,IAAI,EAAET,OAAO,CAACU,OAAO;EAMrBC,SAAS,EAAE,IAAI;EAQfC,KAAK,EAAE,eAAAA,CAAgBC,GAAG,EAAEC,QAAQ,EAAEC,IAAI,EAAE;IACxCb,iBAAiB,CAACa,IAAI,CAAC;IAEvB,MAAMC,OAAO,GAAG;MACZC,UAAU,EAAEA,CAACC,GAAG,EAAEC,MAAM,GAAG,IAAI,EAAEC,MAAM,KAAK;QACxC,OAAO;UACHC,MAAM,EAAE,SAAS;UACjB,GAAGD,MAAM;UACTD;QACJ,CAAC;MACL,CAAC;MAEDG,SAAS,EAAEA,CAACJ,GAAG,EAAEK,KAAK,EAAEH,MAAM,KAAK;QAC/B,MAAMI,IAAI,GAAGD,KAAK,CAACC,IAAI,IAAInB,aAAa,CAACa,GAAG,CAACG,MAAM,CAAC,IAAIf,YAAY;QAEpE,OAAO;UACHe,MAAM,EAAE,OAAO;UACf,GAAGD,MAAM;UACTG,KAAK,EAAE;YACHC,IAAI;YACJC,OAAO,EAAEF,KAAK,CAACG,MAAM,GACfH,KAAK,CAACE,OAAO,GACbrB,IAAI,CAACuB,YAAY,CAACT,GAAG,CAACG,MAAM,CAAC;YACnC,IAAIE,KAAK,CAACK,IAAI,GAAG;cAAEA,IAAI,EAAEL,KAAK,CAACK;YAAK,CAAC,GAAE,IAAI;UAC/C;QACJ,CAAC;MACL;IACJ,CAAC;IAEDf,GAAG,CAACgB,eAAe,CAACd,IAAI,EAAEC,OAAO,CAAC;EACtC;AACJ,CAAC"}